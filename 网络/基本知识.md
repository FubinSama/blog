# 基本知识

## ISO 7层协议

1. **物理层**：机械、电子、定时接口通信信道上的原始比特流传输。传输0，1比特流（IEEE 802.2 , Ethernet v.2 , Internetwork）
2. **数据链路层**：物理寻址，同时将原始比特流转变为逻辑传输线路，即传输数据帧。（SLE , IPinIP, MPLS, XTP, DCAP, PPTP, L2TP, L2F, ATMP, CDP, CGMP, ARP地址解析, RARP逆向地址解析）
3. **网络层**：控制子网的运行，如逻辑编址、分组传输、路由选择。解析IP到物理地址，并找到数据流动的路径。（ICMP , SLIP, IP）
4. **传输层**：接受上一层的数据，在必要的时候把数据进行分隔，并将这些数据交给网络层，且保证这些数据段有效到达端，即识别port到port。（TCP, UDP）
5. **会话层**：不同机器上的用户之间建立及管理会话，包括访问验证和会话管理。（SSL , TLS, DAP, LDAP, RPC）
6. **表示层**：信息的语法语义以及它们的关联，如：加密、解密、转换翻译、压缩、解压缩。（XDP）
7. **应用层**：各种应用程序协议。（HTTP , FTP , SMTP , POP3）

## IPv4地址

最初设计互联网络时，为了便于寻址以及层次化构造网络，每个IP地址包括两个标识码（ID），即网络ID和主机ID。同一个物理网络上的所有主机都使用同一个网络ID，网络上的一个主机（包括网络上工作站，服务器和路由器等）有一个主机ID与其对应。IP地址根据网络ID的不同分为5种类型。

网络号：用于识别主机所在的网络；
主机号：用于识别该网络中的主机。

类别｜位格式｜有效地址｜解释
A类|(0+7位网络号)(24位主机号)|1.0.0.1—126.255.255.254(其中10.x.x.x是局域网地址），第一个字节最多从0-127,而127.x.x.x是换回地址，1.0.0.0是网络号，126.255.255.255是广播地址|保留给政府机构。
B类|(10+14位网络号)(16位主机号)｜128.0.0.1-191.255.255.254(其中172.16.0.0—172.31.255.255是局域网地址，169.254.x.x是dhcp的保留地址)，第一个字节最多从128-191,而128.0.0.0是网络号，191.255.255.255是广播地址|分配给中等规模的公司。
C类|(110+21位网络号)(8位主机号)｜192.0.0.1—223.255.255.254(其中192.168.X.X是局域网地址)，第一个字节最多从192-223,而192.0.0.0是网络号，223.255.255.255是广播地址|分配给任何需要的人。
D类|(1110+28位广播地址)｜224.0.0.1—239.255.255.254，第一个字节最多从192-223,而224.0.0.0是网络号，239.255.255.255是广播地址|用于多点广播。
E类|(11110+27位)｜240~248|保留地址，可用于实验。

可以发现IPv4地址实际上的类别识别码是：`(类别-'A')个1，后跟一个0`。

## 常见协议

### ARP协议

地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。

主机发送信息时，将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。

地址解析协议是建立在网络中各个主机互相信任的基础上的，网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。

ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。

### RARP协议

反向地址转换协议，即RARP（Reverse Address Resolution Protocol）。 反向地址转换协议（RARP）允许局域网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP 地址。

网络管理员在局域网的网关路由器里创建一个表以映射物理地址（MAC）和与其对应的 IP 地址。当设置一台新的机器时，其 RARP 客户机程序需要向路由器上的 RARP 服务器请求相应的 IP 地址。假设在路由表中已经设置了一个记录，RARP 服务器将会返回 IP 地址给机器，此机器就会存储起来以便日后使用。 RARP 可以使用于以太网、光纤分布式数据接口及令牌环 LAN等。
